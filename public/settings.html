<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Settings - Inventory Pro</title>
    <script>
        (function() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Immediately apply the dark mode class if enabled
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.documentElement.classList.add('dark-mode');
            } else {
                document.documentElement.classList.remove('dark-mode');
            }
        })();
    </script>
</head>
<body>
    <div class="dashboard-wrapper">
        <div id="sidenav-placeholder"></div>

        <main class="main-content">
            <header class="dashboard-header">
                <h1>⚙️ System Settings</h1>
            </header>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <section class="table-card" style="padding: 25px;">
                    <h2>App Preferences</h2>
                    <div class="input-group" style="margin-top: 15px;">
                        <label>Low Stock Alert Threshold</label>
                        <input type="number" id="lowStockThreshold" value="10" min="1">
                        <small style="color: #888;">Items below this quantity will highlight in red on the dashboard.</small>
                    </div>
                    <button class="add-main-btn" style="margin-top: 20px;" onclick="savePreferences()">Save Preferences</button>
                </section>

                <section class="table-card" style="padding: 25px;">
                    <h2>System Information</h2>
                    <p><strong>Version:</strong> 1.0.4-Stable</p>
                    <p><strong>Environment:</strong> Local Development</p>
                    <p><strong>Database:</strong> MySQL 8.0</p>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                    <p style="font-size: 0.85rem; color: #888;">Inventory Manager Pro &copy; 2026</p>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Standard component loader
        async function loadComponent(id, path) {
            try {
                const res = await fetch(path);
                const text = await res.text();
                document.getElementById(id).innerHTML = text;
                
                // Re-sync dark mode class to the body after sidebar loads
                if (localStorage.getItem('darkMode') === 'enabled') {
                    document.body.classList.add('dark-mode');
                }
            } catch (err) {
                console.error("Failed to load sidebar:", err);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadComponent('sidenav-placeholder', 'components/sidenav.html');
            
            // Load saved threshold from memory
            const saved = localStorage.getItem('lowStockThreshold');
            if(saved) {
                document.getElementById('lowStockThreshold').value = saved;
            }
        });

        function savePreferences() {
            const val = document.getElementById('lowStockThreshold').value;
            localStorage.setItem('lowStockThreshold', val);
            alert("Preferences saved! Dashboard will now use this threshold.");
        }
    </script>
</body>
</html>