<div id="addModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeAddModal()">&times;</span>
        <h2>Add New Product</h2>
        <hr>
        <form id="productForm">
            <div class="input-group">
                <label>Item Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div class="input-group">
                <label>Product Photo</label>
                <input type="file" id="productImage" name="productImage" accept="image/*" onchange="previewImage(event)">
                <img id="imgPreview" src="#" style="display:none; width:100px; margin-top:10px; border-radius:8px;">
            </div>

            <div class="input-group">
                <label>Quantity</label>
                <input type="number" id="qty" name="qty" required>
            </div>
            <div class="input-group">
                <label>Price (â‚±)</label>
                <input type="number" id="price" name="price" step="0.01" required>
            </div>
            <div class="input-group">
                <label>Category</label>
                <select id="category" name="category" required>
                    <option value="Vegetables">Vegetables</option>
                    <option value="Fruits">Fruits</option>
                    <option value="Supplies">Supplies</option>
                    <option value="Canned Goods">Canned Goods</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="save-btn">Add Product</button>
                <button type="button" class="cancel-btn" onclick="closeAddModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = () => {
        const preview = document.getElementById('imgPreview');
        preview.src = reader.result;
        preview.style.display = 'block';
    };
    reader.readAsDataURL(event.target.files[0]);
}

document.getElementById('productForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);

    const response = await fetch('/api/products/add', {
        method: 'POST',
        body: formData // No Headers needed, FormData sets them automatically
    });
    const result = await response.json();
    if (result.success) {
        alert("Product added!");
        location.reload();
    }
};
</script>