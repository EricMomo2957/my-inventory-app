<nav class="sidenav">
    <div class="nav-header">
        <h2>Inventory Manager</h2>
    </div>

    <div class="nav-profile">
        <div class="side-avatar-wrapper">
            <img src="assets/default-avatar.png" id="sideNavAvatar" alt="Profile" onerror="this.src='assets/default-avatar.png'">
        </div>
        <div class="profile-info">
            <span id="sideNavName">User Name</span>
            <small id="sideNavRole">Clerk</small>
        </div>
    </div>

    <div class="nav-links">
        <p class="section-title">Main Menu</p>
        <a href="index.html" class="nav-item">üè† Dashboard</a>
        <a href="customer-orders.html" class="nav-item">üõí Customer Orders</a> <a href="calendar.html" class="nav-item">üìÖ Calendar</a>
        
        <p class="section-title">User Account</p>
        <a href="profile.html" class="nav-item">üë§ Profile</a>
        <a href="settings.html" class="nav-item">‚öôÔ∏è Settings</a>
        <a href="admin_management.html" class="nav-item admin-link" style="color: #ff9f43; display: none;">üõ°Ô∏è Admin Management</a>
    </div>

    <div class="nav-footer">
        <button id="themeToggle" class="nav-btn" onclick="toggleDarkMode()">üåô Dark Mode</button>
        <button class="nav-btn logout-btn" onclick="logout()">üö™ Logout</button>
    </div>
</nav>

<style>
    /* Theme Variables */
    :root {
        --side-bg: #ffffff;
        --side-text: #333333;
        --side-hover: #f0f2f5;
        --side-profile-bg: rgba(0, 0, 0, 0.05);
        --side-border: #eeeeee;
    }

    /* Dark Mode Variables */
    .dark-mode {
        --side-bg: #1e293b;
        --side-text: #f8fafc;
        --side-hover: rgba(255, 255, 255, 0.1);
        --side-profile-bg: rgba(255, 255, 255, 0.08);
        --side-border: #334155;
    }

    .sidenav {
        width: 260px;
        height: 100vh;
        background: var(--side-bg);
        color: var(--side-text);
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--side-border);
        transition: background 0.3s, color 0.3s;
    }

    .nav-header { padding: 20px; text-align: center; border-bottom: 1px solid var(--side-border); }

    .nav-profile {
        display: flex;
        align-items: center;
        padding: 15px;
        margin: 15px;
        background: var(--side-profile-bg);
        border-radius: 12px;
        gap: 12px;
    }

    .side-avatar-wrapper { width: 45px; height: 45px; }
    #sideNavAvatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #4361ee; }

    .nav-links { flex-grow: 1; overflow-y: auto; }
    .section-title { font-size: 0.7rem; text-transform: uppercase; margin: 20px 20px 10px; opacity: 0.6; }

    .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        text-decoration: none;
        color: var(--side-text);
        transition: 0.2s;
        gap: 10px;
    }

    .nav-item:hover { background: var(--side-hover); }

    .nav-footer { padding: 15px; border-top: 1px solid var(--side-border); display: flex; flex-direction: column; gap: 10px; }
    .nav-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: var(--side-profile-bg);
        color: var(--side-text);
        font-weight: 500;
        transition: 0.2s;
    }
    .nav-btn:hover { background: var(--side-hover); }
    .logout-btn { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

    #sideNavName {
    color: var(--text-main); /* Now turns white in dark mode */
}
#sideNavRole {
    color: var(--text-muted); /* Now turns light gray in dark mode */
}
.nav-item {
    color: var(--text-main);
}
</style>

<script>
    /**
     * DARK MODE LOGIC
     */
    function toggleDarkMode() {
        const isDark = document.documentElement.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
        updateThemeButton(isDark);
    }

    function updateThemeButton(isDark) {
        const btn = document.getElementById('themeToggle');
        if (btn) {
            btn.innerHTML = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }
    }

    /**
     * UI SYNC LOGIC
     */
    function syncSidebarUI() {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        if (!user) return;

        // Apply theme from preference
        const darkMode = localStorage.getItem('darkMode');
        if (darkMode === 'enabled') {
            document.documentElement.classList.add('dark-mode');
            updateThemeButton(true);
        }

        // Update Name and Role
        document.getElementById('sideNavName').innerText = user.full_name || user.username;
        document.getElementById('sideNavRole').innerText = user.role || 'clerk';

        // Update Avatar from MySQL profile_image column
        const sideAvatar = document.getElementById('sideNavAvatar');
        if (sideAvatar && user.profile_image && user.profile_image !== "NULL") {
            sideAvatar.src = user.profile_image;
        }

        // Role-based Access Control
        const adminLink = document.querySelector('.admin-link');
        if (adminLink && user.role === 'admin') {
            adminLink.style.display = 'block';
        }
    }

    function logout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
    }

    // Run on load
    syncSidebarUI();
</script>