<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>User Management - Inventory Pro</title>
    
    <script>
        (function() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Immediately apply the dark mode class if enabled
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.documentElement.classList.add('dark-mode');
            } else {
                document.documentElement.classList.remove('dark-mode');
            }
        })();
    </script>
</head>
<body>
    <div class="dashboard-wrapper">
        <div id="sidenav-placeholder"></div>

        <main class="main-content">
            <header class="dashboard-header">
                <div>
                    <h1>üõ°Ô∏è User Management</h1>
                    <p style="color: #888;">Monitor activity and manage system access roles</p>
                </div>
                <button class="add-main-btn" onclick="openModal('userModal')">
                    <span>‚ûï</span> Create New User
                </button>
            </header>

            
                <div class="table-responsive">
                    <section class="table-card">
                        <div class="table-responsive">
                            <table class="user-table">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Full Name & Email</th>
                                        <th>Department</th>
                                        <th>Role</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </section>
        </main>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Create New Account</h2>
                <span class="close-btn" onclick="closeModal('userModal')">&times;</span>
            </header>
            <form id="userForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="input-group">
                        <label>Username</label>
                      <section class="table-card">  <input type="text" id="regUser" required>
                    </div>
                    <div class="input-group">
                        <label>Full Name</label>
                        <input type="text" id="regFullName" required>
                    </div>
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="user@gmail.com">
                    </div>
                    <div class="input-group">
                        <label>Admin ID</label>
                        <input type="text" id="regAdminId" placeholder="e.g. 0000">
                    </div>
                    <div class="input-group">
                        <label>Department</label>
                        <input type="text" id="regDept" placeholder="e.g. General">
                    </div>
                    <div class="input-group">
                        <label>System Role</label>
                        <select id="regRole">
                            <option value="clerk">Clerk</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                            <option value="auditor">Auditor</option>
                        </select>
                    </div>
                </div>
                <div class="input-group" style="margin-top: 15px;">
                    <label>Password</label>
                    <input type="password" id="regPass" required>
                </div>
                <button type="submit" class="add-main-btn" style="width: 100%; margin-top: 20px; justify-content: center;">
                    Create Account
                </button>
            </form>
        </div>
    </div>

    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Edit User Account</h2>
                <span class="close-btn" onclick="closeModal('editUserModal')">&times;</span>
            </header>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="editUsername" required>
                </div>
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" id="editFullName" required>
                </div>
                <div class="input-group">
                    <label>New Password (Leave blank to keep current)</label>
                    <input type="password" id="editPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="input-group">
                    <label>System Role</label>
                    <select id="editRole">
                        <option value="clerk">Clerk</option>
                        <option value="manager">Manager</option>
                        <option value="admin">Admin</option>
                        <option value="auditor">Auditor</option>
                    </select>
                </div>
                <button type="submit" class="add-main-btn" style="width: 100%; margin-top: 20px; background: #4361ee; justify-content: center;">
                    Update User Account
                </button>
            </form>
        </div>
    </div>

    <script src="js/users_admin.js"></script>
    <script>
        /**
         * 1. MODAL HELPERS
         */
        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // Close modal when clicking outside the content box
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }

        /**
         * 2. DATA SEEDING, SIDEBAR & INITIALIZATION
         */
        async function initializePage() {
            // Seed data if localStorage is empty
            if (!localStorage.getItem('users')) {
                const initialUsers = [{
                    id: 1,
                    username: "admin",
                    full_name: "System Administrator",
                    role: "admin",
                    profile_image: "assets/default-avatar.png"
                }];
                localStorage.setItem('users', JSON.stringify(initialUsers));
            }

            // Load Sidebar
            try {
                const res = await fetch('components/sidenav.html');
                const text = await res.text();
                document.getElementById('sidenav-placeholder').innerHTML = text;
                if (typeof syncSidebarUI === 'function') syncSidebarUI();
            } catch (err) {
                console.error("Sidebar load failed:", err);
            }

            // Trigger Table Render
            if (typeof fetchAndRenderUsers === 'function') {
                fetchAndRenderUsers();
            }
        }

        window.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>